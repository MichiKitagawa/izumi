---

## **ステップ1: 開発環境の準備**

### **1.1. 必要なソフトウェアのインストール**

1. **Gitのインストール**
    - **Windowsの場合:**
        - [Git公式サイト](https://git-scm.com/download/win)からGitをダウンロードし、インストールします。
        - インストール中のオプションはデフォルトのままで問題ありません。
2. **Node.jsのインストール**
    - **Windowsの場合:**
        - [Node.js公式サイト](https://nodejs.org/)から最新のLTS（長期サポート）バージョンをダウンロードし、インストールします。
        - インストール後、コマンドプロンプト（またはPowerShell）を開き、以下のコマンドでインストールが成功したか確認します。
            
            ```bash
            node -v
            npm -v
            
            ```
            
3. **Visual Studio Code (VSCode) のインストール**
    - [VSCode公式サイト](https://code.visualstudio.com/)からダウンロードし、インストールします。
    - **推奨拡張機能:**
        - **ESLint:** コードの品質を保つためのツール。
        - **Prettier:** コードの整形ツール。
        - **GitLens:** Git操作を支援する拡張機能。
        - **React Native Tools:** React Native開発支援。
        - **Docker:** Dockerファイルの編集支援。
4. **PostgreSQLのインストール**
    - [PostgreSQL公式サイト](https://www.postgresql.org/download/)からインストールします。
    - インストール中に設定したパスワードを控えておいてください。
5. **AWS CLIのインストール（オプション）**
    - AWSを使用する場合、[AWS CLI公式ガイド](https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2.html)に従ってインストールします。

### **1.2. GitHubリポジトリの作成**

1. **GitHubアカウントの作成**
    - まだ持っていない場合は、[GitHub](https://github.com/)でアカウントを作成します。
2. **新しいリポジトリの作成**
    - GitHubにログインし、右上の「+」ボタンから「New repository」を選択します。
    - **リポジトリ名:** `izumi`
    - **説明:** `情報商材サブスクリプションプラットフォーム`
    - **プライバシー設定:** 公開（Public）または非公開（Private）を選択。
    - **初期設定:** READMEファイルを追加するオプションにチェックを入れて、「Create repository」をクリックします。

### **1.3. プロジェクトディレクトリの構造作成**

1. **プロジェクトフォルダの作成**
    - 任意の場所（例: `C:\Users\k0803\Projects`）に`izumi`フォルダを作成します。
        
        ```bash
        mkdir C:\Users\k0803\Projects\izumi
        cd C:\Users\k0803\Projects\izumi
        
        ```
        
2. **サブディレクトリの作成**
    - `client`（Webアプリ用）と`server`（バックエンド用）フォルダを作成します。
        
        ```bash
        mkdir client
        mkdir server
        
        ```
        

### **1.4. Gitリポジトリの初期化と設定**

1. **リポジトリの初期化**
    - プロジェクトルート（`izumi`フォルダ）でGitを初期化します。
        
        ```bash
        git init
        
        ```
        
2. **リモートリポジトリの追加**
    - 作成したGitHubリポジトリをリモートとして追加します。
        
        ```bash
        git remote add origin https://github.com/あなたのGitHubユーザー名/izumi.git
        
        ```
        
3. **初回コミットの作成**
    - `client`と`server`フォルダをGitに追加し、初回コミットを行います。
        
        ```bash
        git add .
        git commit -m "Initial commit with client and server directories"
        git push -u origin master
        
        ```
        

---

## **ステップ2: バックエンドのセットアップ**

### **2.1. Node.jsプロジェクトの初期化**

1. **サーバーディレクトリに移動**
    
    ```bash
    cd server
    
    ```
    
2. **npmプロジェクトの初期化**
    
    ```bash
    npm init -y
    
    ```
    
    - これにより、`package.json`が生成されます。

### **2.2. 必要なパッケージのインストール**

1. **Express.jsのインストール**
    
    ```bash
    npm install express
    
    ```
    
2. **開発用依存関係のインストール**
    
    ```bash
    npm install --save-dev nodemon typescript @types/express ts-node
    
    ```
    
    - **nodemon:** コード変更時に自動でサーバーを再起動。
    - **typescript:** TypeScriptのコンパイラ。
    - **@types/express:** Express.jsの型定義。
    - **ts-node:** TypeScriptファイルを直接実行。
3. **TypeScriptの初期化**
    
    ```bash
    npx tsc --init
    
    ```
    
    - `tsconfig.json`が生成されます。以下の設定を追加または変更してください。
        
        ```json
        {
          "compilerOptions": {
            "target": "ES6",
            "module": "commonjs",
            "rootDir": "./src",
            "outDir": "./dist",
            "esModuleInterop": true,
            "strict": true,
            "skipLibCheck": true
          }
        }
        
        ```
        

### **2.3. ディレクトリ構造の作成**

1. **ソースコード用フォルダの作成**
    
    ```bash
    mkdir src
    cd src
    
    ```
    
2. **基本的なファイルの作成**
    - `index.ts`: サーバーのエントリーポイント。
        
        ```tsx
        // src/index.ts
        import express from 'express';
        
        const app = express();
        const PORT = process.env.PORT || 5000;
        
        app.get('/', (req, res) => {
          res.send('Hello izumi!');
        });
        
        app.listen(PORT, () => {
          console.log(`Server is running on port ${PORT}`);
        });
        
        ```
        

### **2.4. 開発スクリプトの設定**

1. **`package.json`の修正**
    - `scripts`セクションを以下のように変更します。
        
        ```json
        "scripts": {
          "build": "tsc",
          "start": "node dist/index.js",
          "dev": "nodemon src/index.ts"
        },
        
        ```
        

### **2.5. サーバーの起動確認**

1. **開発サーバーの起動**
    
    ```bash
    npm run dev
    
    ```
    
    - ブラウザで`http://localhost:5000`にアクセスし、「Hello izumi!」と表示されれば成功です。

### **2.6. Gitへのコミット**

1. **変更のステージングとコミット**
    
    ```bash
    git add .
    git commit -m "Set up Express server with TypeScript"
    git push
    
    ```
    

---

## **ステップ3: フロントエンドのセットアップ**

### **3.1. React.jsプロジェクトの初期化**

1. **クライアントディレクトリに移動**
    
    ```bash
    cd ../client
    
    ```
    
2. **Viteを使用したReactプロジェクトの作成**
    
    ```bash
    npm create vite@latest
    
    ```
    
    - **プロジェクト名:** `client`（既にクライアントディレクトリ内にいるため、適宜選択）
    - **テンプレート選択:** `React` を選びます。
3. **依存関係のインストール**
    
    ```bash
    npm install
    
    ```
    

### **3.2. 必要なパッケージのインストール**

1. **React Routerのインストール**
    
    ```bash
    npm install react-router-dom
    
    ```
    
2. **Reduxと関連パッケージのインストール**
    
    ```bash
    npm install redux react-redux @reduxjs/toolkit
    
    ```
    
3. **Material-UIのインストール**
    
    ```bash
    npm install @mui/material @emotion/react @emotion/styled
    
    ```
    
4. **その他必要なパッケージのインストール**
    - **Axios（HTTPクライアント）**
        
        ```bash
        npm install axios
        
        ```
        
    - **その他UIコンポーネントやライブラリ**
        
        ```bash
        npm install @tanstack/react-query lucide-react react-hook-form @hookform/resolvers zod
        
        ```
        

### **3.3. プロジェクトのディレクトリ構造の整理**

1. **`src`フォルダ内に必要なサブフォルダを作成**
    
    ```bash
    mkdir src/components
    mkdir src/pages
    mkdir src/hooks
    mkdir src/utils
    
    ```
    
2. **パスエイリアスの設定**
    - **`tsconfig.json`の編集**
        
        ```json
        {
          "compilerOptions": {
            ...
            "baseUrl": "./",
            "paths": {
              "@/*": ["src/*"]
            }
          }
        }
        
        ```
        
    - **`vite.config.ts`の編集**
        
        ```tsx
        import { defineConfig } from 'vite';
        import react from '@vitejs/plugin-react';
        import path from 'path';
        
        export default defineConfig({
          plugins: [react()],
          resolve: {
            alias: {
              '@': path.resolve(__dirname, 'src'),
            },
          },
        });
        
        ```
        

### **3.4. 開発サーバーの起動確認**

1. **開発サーバーの起動**
    
    ```bash
    npm run dev
    
    ```
    
    - ブラウザで表示されたURL（通常は`http://localhost:5173/`）にアクセスし、Reactの初期画面が表示されることを確認します。

### **3.5. Gitへのコミット**

1. **変更のステージングとコミット**
    
    ```bash
    git add .
    git commit -m "Set up React frontend with Vite and initial configurations"
    git push
    
    ```
    

---

## **ステップ4: データベースの設定**

### **4.1. PostgreSQLのデータベースとユーザーの作成**

1. **PostgreSQLにログイン**
    - コマンドプロンプトまたはPowerShellで以下を実行します。
        
        ```bash
        psql -U postgres
        
        ```
        
    - インストール時に設定したパスワードを入力します。
2. **新しいデータベースの作成**
    
    ```sql
    CREATE DATABASE izumi_db;
    
    ```
    
3. **新しいユーザーの作成と権限の付与**
    
    ```sql
    CREATE USER izumi_user WITH PASSWORD 'secure_password';
    GRANT ALL PRIVILEGES ON DATABASE izumi_db TO izumi_user;
    
    ```
    
4. **PostgreSQLからのログアウト**
    
    ```sql
    \q
    
    ```
    

### **4.2. サーバーでのデータベース接続設定**

1. **必要なパッケージのインストール**
    
    ```bash
    npm install pg sequelize
    npm install --save-dev @types/pg
    
    ```
    
    - **pg:** PostgreSQLクライアント
    - **sequelize:** ORM（Object-Relational Mapping）ツール
2. **Sequelizeの初期化**
    - **設定ファイルの作成**
        
        ```bash
        mkdir src/config
        touch src/config/database.ts
        
        ```
        
    - **`database.ts`の内容**
        
        ```tsx
        // src/config/database.ts
        import { Sequelize } from 'sequelize';
        
        const sequelize = new Sequelize('izumi_db', 'izumi_user', 'secure_password', {
          host: 'localhost',
          dialect: 'postgres',
        });
        
        export default sequelize;
        
        ```
        
3. **データベース接続のテスト**
    - **`index.ts`の修正**
        
        ```tsx
        // src/index.ts
        import express from 'express';
        import sequelize from './config/database';
        
        const app = express();
        const PORT = process.env.PORT || 5000;
        
        app.get('/', (req, res) => {
          res.send('Hello izumi!');
        });
        
        sequelize.authenticate()
          .then(() => {
            console.log('Database connected...');
          })
          .catch((err) => {
            console.error('Unable to connect to the database:', err);
          });
        
        app.listen(PORT, () => {
          console.log(`Server is running on port ${PORT}`);
        });
        
        ```
        
    - **サーバーの再起動**
        
        ```bash
        npm run dev
        
        ```
        
    - **確認**
        - コンソールに「Database connected...」と表示されれば成功です。
4. **Gitへのコミット**
    
    ```bash
    git add .
    git commit -m "Set up PostgreSQL database connection with Sequelize"
    git push
    
    ```
    

---

## **ステップ5: ユーザー管理機能の実装**

### **5.1. ユーザーモデルの作成**

1. **モデルディレクトリの作成**
    
    ```bash
    mkdir src/models
    
    ```
    
2. **Userモデルの作成**
    - **`User.ts`の作成**
        
        ```tsx
        // src/models/User.ts
        import { DataTypes, Model } from 'sequelize';
        import sequelize from '../config/database';
        
        class User extends Model {
          public id!: number;
          public email!: string;
          public password!: string;
          public name!: string;
          public profileImage!: string;
          public role!: string; // 'subscriber', 'provider', 'admin'
          public readonly createdAt!: Date;
          public readonly updatedAt!: Date;
        }
        
        User.init(
          {
            id: {
              type: DataTypes.INTEGER,
              autoIncrement: true,
              primaryKey: true,
            },
            email: {
              type: DataTypes.STRING,
              allowNull: false,
              unique: true,
            },
            password: {
              type: DataTypes.STRING,
              allowNull: false,
            },
            name: {
              type: DataTypes.STRING,
              allowNull: false,
            },
            profileImage: {
              type: DataTypes.STRING,
              allowNull: true,
            },
            role: {
              type: DataTypes.STRING,
              allowNull: false,
              defaultValue: 'subscriber',
            },
          },
          {
            sequelize,
            tableName: 'users',
          }
        );
        
        export default User;
        
        ```
        
3. **データベースにモデルを同期**
    - **`index.ts`の修正**
        
        ```tsx
        // src/index.ts
        import express from 'express';
        import sequelize from './config/database';
        import User from './models/User';
        
        const app = express();
        const PORT = process.env.PORT || 5000;
        
        app.use(express.json());
        
        app.get('/', (req, res) => {
          res.send('Hello izumi!');
        });
        
        sequelize.authenticate()
          .then(() => {
            console.log('Database connected...');
            return sequelize.sync();
          })
          .then(() => {
            console.log('Models synchronized.');
          })
          .catch((err) => {
            console.error('Unable to connect to the database:', err);
          });
        
        app.listen(PORT, () => {
          console.log(`Server is running on port ${PORT}`);
        });
        
        ```
        
4. **サーバーの再起動と確認**
    
    ```bash
    npm run dev
    
    ```
    
    - コンソールに「Models synchronized.」と表示されれば成功です。
5. **Gitへのコミット**
    
    ```bash
    git add .
    git commit -m "Create User model and synchronize with database"
    git push
    
    ```
    

### **5.2. ユーザー登録・ログインAPIの実装**

1. **必要なパッケージのインストール**
    
    ```bash
    npm install bcrypt jsonwebtoken
    npm install --save-dev @types/bcrypt @types/jsonwebtoken
    
    ```
    
    - **bcrypt:** パスワードのハッシュ化。
    - **jsonwebtoken:** JWT認証用。
2. **認証ルートの作成**
    - **ルートディレクトリの作成**
        
        ```bash
        mkdir src/routes
        
        ```
        
    - **`auth.ts`の作成**
        
        ```tsx
        // src/routes/auth.ts
        import { Router, Request, Response } from 'express';
        import bcrypt from 'bcrypt';
        import jwt from 'jsonwebtoken';
        import User from '../models/User';
        
        const router = Router();
        
        // ユーザー登録
        router.post('/register', async (req: Request, res: Response) => {
          const { email, password, name } = req.body;
        
          try {
            // 既存ユーザーの確認
            const existingUser = await User.findOne({ where: { email } });
            if (existingUser) {
              return res.status(400).json({ message: 'Email already in use.' });
            }
        
            // パスワードのハッシュ化
            const hashedPassword = await bcrypt.hash(password, 10);
        
            // ユーザーの作成
            const user = await User.create({
              email,
              password: hashedPassword,
              name,
            });
        
            res.status(201).json({ message: 'User registered successfully.' });
          } catch (error) {
            console.error(error);
            res.status(500).json({ message: 'Server error.' });
          }
        });
        
        // ユーザーログイン
        router.post('/login', async (req: Request, res: Response) => {
          const { email, password } = req.body;
        
          try {
            const user = await User.findOne({ where: { email } });
            if (!user) {
              return res.status(400).json({ message: 'Invalid credentials.' });
            }
        
            // パスワードの比較
            const isMatch = await bcrypt.compare(password, user.password);
            if (!isMatch) {
              return res.status(400).json({ message: 'Invalid credentials.' });
            }
        
            // JWTの生成
            const token = jwt.sign(
              { id: user.id, email: user.email, role: user.role },
              'your_jwt_secret', // 環境変数に置き換えることを推奨
              { expiresIn: '1h' }
            );
        
            res.status(200).json({ token });
          } catch (error) {
            console.error(error);
            res.status(500).json({ message: 'Server error.' });
          }
        });
        
        export default router;
        
        ```
        
3. **ルートの統合**
    - **`index.ts`の修正**
        
        ```tsx
        // src/index.ts
        import express from 'express';
        import sequelize from './config/database';
        import User from './models/User';
        import authRoutes from './routes/auth';
        
        const app = express();
        const PORT = process.env.PORT || 5000;
        
        app.use(express.json());
        
        app.use('/api/auth', authRoutes);
        
        app.get('/', (req, res) => {
          res.send('Hello izumi!');
        });
        
        sequelize.authenticate()
          .then(() => {
            console.log('Database connected...');
            return sequelize.sync();
          })
          .then(() => {
            console.log('Models synchronized.');
          })
          .catch((err) => {
            console.error('Unable to connect to the database:', err);
          });
        
        app.listen(PORT, () => {
          console.log(`Server is running on port ${PORT}`);
        });
        
        ```
        
4. **サーバーの再起動とAPIのテスト**
    - **サーバーの起動**
        
        ```bash
        npm run dev
        
        ```
        
    - **APIのテスト**
        - [Postman](https://www.postman.com/)などのツールを使用して、以下のエンドポイントをテストします。
            - **登録:**
                - **URL:** `http://localhost:5000/api/auth/register`
                - **メソッド:** POST
                - **ボディ:** JSON
                    
                    ```json
                    {
                      "email": "user@example.com",
                      "password": "password123",
                      "name": "John Doe"
                    }
                    
                    ```
                    
            - **ログイン:**
                - **URL:** `http://localhost:5000/api/auth/login`
                - **メソッド:** POST
                - **ボディ:** JSON
                    
                    ```json
                    {
                      "email": "user@example.com",
                      "password": "password123"
                    }
                    
                    ```
                    
        - **期待されるレスポンス:**
            - 登録成功時: `201 Created` とメッセージ。
            - ログイン成功時: `200 OK` とJWTトークン。
5. **Gitへのコミット**
    
    ```bash
    git add .
    git commit -m "Implement user registration and login APIs with JWT authentication"
    git push
    
    ```
    

---

## **ステップ6: フロントエンドでのユーザー登録・ログイン機能の実装**

### **6.1. React Routerの設定**

1. **ルーティングの設定**
    - **`src/main.tsx`の編集**
        
        ```tsx
        // src/main.tsx
        import React from 'react';
        import ReactDOM from 'react-dom';
        import { BrowserRouter as Router, Routes, Route } from 'react-router-dom';
        import App from './App';
        import Register from './pages/Register';
        import Login from './pages/Login';
        
        ReactDOM.render(
          <React.StrictMode>
            <Router>
              <Routes>
                <Route path="/" element={<App />} />
                <Route path="/register" element={<Register />} />
                <Route path="/login" element={<Login />} />
              </Routes>
            </Router>
          </React.StrictMode>,
          document.getElementById('root')
        );
        
        ```
        

### **6.2. ページコンポーネントの作成**

1. **`Register.tsx`の作成**
    
    ```tsx
    // src/pages/Register.tsx
    import React, { useState } from 'react';
    import axios from 'axios';
    import { TextField, Button, Container, Typography } from '@mui/material';
    
    const Register: React.FC = () => {
      const [email, setEmail] = useState('');
      const [password, setPassword] = useState('');
      const [name, setName] = useState('');
      const [message, setMessage] = useState('');
    
      const handleRegister = async (e: React.FormEvent) => {
        e.preventDefault();
        try {
          const res = await axios.post('/api/auth/register', { email, password, name });
          setMessage(res.data.message);
        } catch (error: any) {
          setMessage(error.response?.data?.message || 'Registration failed.');
        }
      };
    
      return (
        <Container maxWidth="sm">
          <Typography variant="h4" gutterBottom>
            Register
          </Typography>
          <form onSubmit={handleRegister}>
            <TextField
              label="Name"
              variant="outlined"
              fullWidth
              margin="normal"
              value={name}
              onChange={(e) => setName(e.target.value)}
              required
            />
            <TextField
              label="Email"
              type="email"
              variant="outlined"
              fullWidth
              margin="normal"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              required
            />
            <TextField
              label="Password"
              type="password"
              variant="outlined"
              fullWidth
              margin="normal"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              required
            />
            <Button type="submit" variant="contained" color="primary" fullWidth>
              Register
            </Button>
          </form>
          {message && <Typography variant="body1">{message}</Typography>}
        </Container>
      );
    };
    
    export default Register;
    
    ```
    
2. **`Login.tsx`の作成**
    
    ```tsx
    // src/pages/Login.tsx
    import React, { useState } from 'react';
    import axios from 'axios';
    import { TextField, Button, Container, Typography } from '@mui/material';
    
    const Login: React.FC = () => {
      const [email, setEmail] = useState('');
      const [password, setPassword] = useState('');
      const [message, setMessage] = useState('');
    
      const handleLogin = async (e: React.FormEvent) => {
        e.preventDefault();
        try {
          const res = await axios.post('/api/auth/login', { email, password });
          localStorage.setItem('token', res.data.token);
          setMessage('Login successful!');
        } catch (error: any) {
          setMessage(error.response?.data?.message || 'Login failed.');
        }
      };
    
      return (
        <Container maxWidth="sm">
          <Typography variant="h4" gutterBottom>
            Login
          </Typography>
          <form onSubmit={handleLogin}>
            <TextField
              label="Email"
              type="email"
              variant="outlined"
              fullWidth
              margin="normal"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              required
            />
            <TextField
              label="Password"
              type="password"
              variant="outlined"
              fullWidth
              margin="normal"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              required
            />
            <Button type="submit" variant="contained" color="primary" fullWidth>
              Login
            </Button>
          </form>
          {message && <Typography variant="body1">{message}</Typography>}
        </Container>
      );
    };
    
    export default Login;
    
    ```
    
3. **`App.tsx`の編集**
    - 必要に応じてナビゲーションバーや他のページへのリンクを追加します。
    
    ```tsx
    // src/App.tsx
    import React from 'react';
    import { Link } from 'react-router-dom';
    import { AppBar, Toolbar, Typography, Button } from '@mui/material';
    
    const App: React.FC = () => {
      return (
        <div>
          <AppBar position="static">
            <Toolbar>
              <Typography variant="h6" style={{ flexGrow: 1 }}>
                izumi
              </Typography>
              <Button color="inherit" component={Link} to="/register">
                Register
              </Button>
              <Button color="inherit" component={Link} to="/login">
                Login
              </Button>
            </Toolbar>
          </AppBar>
          <Typography variant="h3" align="center" style={{ marginTop: '50px' }}>
            Welcome to izumi
          </Typography>
        </div>
      );
    };
    
    export default App;
    
    ```
    

### **6.3. プロキシ設定の追加**

1. **`vite.config.ts`の編集**
    - フロントエンドからバックエンドへのAPIリクエストをプロキシする設定を追加します。
        
        ```tsx
        // vite.config.ts
        import { defineConfig } from 'vite';
        import react from '@vitejs/plugin-react';
        import path from 'path';
        
        export default defineConfig({
          plugins: [react()],
          resolve: {
            alias: {
              '@': path.resolve(__dirname, 'src'),
            },
          },
          server: {
            proxy: {
              '/api': {
                target: 'http://localhost:5000',
                changeOrigin: true,
                secure: false,
              },
            },
          },
        });
        
        ```
        

### **6.4. サーバーのCORS設定**

1. **CORSパッケージのインストール**
    
    ```bash
    npm install cors
    npm install --save-dev @types/cors
    
    ```
    
2. **`index.ts`の修正**
    
    ```tsx
    // src/index.ts
    import express from 'express';
    import sequelize from './config/database';
    import User from './models/User';
    import authRoutes from './routes/auth';
    import cors from 'cors';
    
    const app = express();
    const PORT = process.env.PORT || 5000;
    
    app.use(cors());
    app.use(express.json());
    
    app.use('/api/auth', authRoutes);
    
    app.get('/', (req, res) => {
      res.send('Hello izumi!');
    });
    
    sequelize.authenticate()
      .then(() => {
        console.log('Database connected...');
        return sequelize.sync();
      })
      .then(() => {
        console.log('Models synchronized.');
      })
      .catch((err) => {
        console.error('Unable to connect to the database:', err);
      });
    
    app.listen(PORT, () => {
      console.log(`Server is running on port ${PORT}`);
    });
    
    ```
    
3. **サーバーとフロントエンドの再起動**
    - **サーバー:**
        
        ```bash
        npm run dev
        
        ```
        
    - **クライアント:**
        
        ```bash
        cd ../client
        npm run dev
        
        ```
        

### **6.5. フロントエンドからのAPIリクエストのテスト**

1. **ブラウザで`http://localhost:5173/register`にアクセスし、ユーザー登録フォームに必要事項を入力して送信します。**
    - 登録が成功すると、「User registered successfully.」というメッセージが表示されます。
2. **同様に、`http://localhost:5173/login`にアクセスし、登録したユーザーでログインします。**
    - ログインが成功すると、「Login successful!」というメッセージが表示され、JWTトークンがローカルストレージに保存されます。

### **6.6. Gitへのコミット**

1. **変更のステージングとコミット**
    
    ```bash
    git add .
    git commit -m "Implement frontend user registration and login pages with API integration"
    git push
    
    ```
    

---

## **ステップ7: ユーザープロフィール編集機能の実装**

### **7.1. バックエンドでのプロフィール編集APIの実装**

1. **`User`モデルの拡張**
    - 既に`name`と`profileImage`フィールドが存在しますが、必要に応じて追加フィールドを追加します。
2. **プロフィール編集ルートの作成**
    - **`profile.ts`の作成**
        
        ```tsx
        // src/routes/profile.ts
        import { Router, Request, Response } from 'express';
        import jwt from 'jsonwebtoken';
        import User from '../models/User';
        
        const router = Router();
        
        // ミドルウェア: JWT認証
        const authenticateToken = (req: Request, res: Response, next: Function) => {
          const authHeader = req.headers['authorization'];
          const token = authHeader && authHeader.split(' ')[1];
        
          if (!token) return res.sendStatus(401);
        
          jwt.verify(token, 'your_jwt_secret', (err: any, user: any) => {
            if (err) return res.sendStatus(403);
            req.body.user = user;
            next();
          });
        };
        
        // プロフィール取得
        router.get('/', authenticateToken, async (req: Request, res: Response) => {
          const userId = req.body.user.id;
          try {
            const user = await User.findByPk(userId, {
              attributes: ['id', 'email', 'name', 'profileImage', 'role'],
            });
            if (!user) {
              return res.status(404).json({ message: 'User not found.' });
            }
            res.status(200).json(user);
          } catch (error) {
            console.error(error);
            res.status(500).json({ message: 'Server error.' });
          }
        });
        
        // プロフィール編集
        router.put('/', authenticateToken, async (req: Request, res: Response) => {
          const userId = req.body.user.id;
          const { name, profileImage } = req.body;
        
          try {
            const user = await User.findByPk(userId);
            if (!user) {
              return res.status(404).json({ message: 'User not found.' });
            }
        
            user.name = name || user.name;
            user.profileImage = profileImage || user.profileImage;
        
            await user.save();
        
            res.status(200).json({ message: 'Profile updated successfully.' });
          } catch (error) {
            console.error(error);
            res.status(500).json({ message: 'Server error.' });
          }
        });
        
        export default router;
        
        ```
        
3. **ルートの統合**
    - **`index.ts`の修正**
        
        ```tsx
        // src/index.ts
        import express from 'express';
        import sequelize from './config/database';
        import User from './models/User';
        import authRoutes from './routes/auth';
        import profileRoutes from './routes/profile';
        import cors from 'cors';
        
        const app = express();
        const PORT = process.env.PORT || 5000;
        
        app.use(cors());
        app.use(express.json());
        
        app.use('/api/auth', authRoutes);
        app.use('/api/profile', profileRoutes);
        
        app.get('/', (req, res) => {
          res.send('Hello izumi!');
        });
        
        sequelize.authenticate()
          .then(() => {
            console.log('Database connected...');
            return sequelize.sync();
          })
          .then(() => {
            console.log('Models synchronized.');
          })
          .catch((err) => {
            console.error('Unable to connect to the database:', err);
          });
        
        app.listen(PORT, () => {
          console.log(`Server is running on port ${PORT}`);
        });
        
        ```
        
4. **サーバーの再起動とAPIのテスト**
    
    ```bash
    npm run dev
    
    ```
    
    - **プロフィール取得:**
        - **URL:** `http://localhost:5000/api/profile/`
        - **メソッド:** GET
        - **ヘッダー:** `Authorization: Bearer <JWTトークン>`
    - **プロフィール編集:**
        - **URL:** `http://localhost:5000/api/profile/`
        - **メソッド:** PUT
        - **ヘッダー:** `Authorization: Bearer <JWTトークン>`
        - **ボディ:** JSON
            
            ```json
            {
              "name": "Jane Doe",
              "profileImage": "https://example.com/image.jpg"
            }
            
            ```
            

### **7.2. フロントエンドでのプロフィール編集ページの作成**

1. **`Profile.tsx`の作成**
    
    ```tsx
    // src/pages/Profile.tsx
    import React, { useState, useEffect } from 'react';
    import axios from 'axios';
    import { TextField, Button, Container, Typography } from '@mui/material';
    
    const Profile: React.FC = () => {
      const [name, setName] = useState('');
      const [profileImage, setProfileImage] = useState('');
      const [message, setMessage] = useState('');
    
      useEffect(() => {
        const fetchProfile = async () => {
          const token = localStorage.getItem('token');
          try {
            const res = await axios.get('/api/profile/', {
              headers: {
                Authorization: `Bearer ${token}`,
              },
            });
            setName(res.data.name);
            setProfileImage(res.data.profileImage);
          } catch (error: any) {
            setMessage(error.response?.data?.message || 'Failed to fetch profile.');
          }
        };
    
        fetchProfile();
      }, []);
    
      const handleUpdate = async (e: React.FormEvent) => {
        e.preventDefault();
        const token = localStorage.getItem('token');
        try {
          const res = await axios.put(
            '/api/profile/',
            { name, profileImage },
            {
              headers: {
                Authorization: `Bearer ${token}`,
              },
            }
          );
          setMessage(res.data.message);
        } catch (error: any) {
          setMessage(error.response?.data?.message || 'Update failed.');
        }
      };
    
      return (
        <Container maxWidth="sm">
          <Typography variant="h4" gutterBottom>
            Profile
          </Typography>
          <form onSubmit={handleUpdate}>
            <TextField
              label="Name"
              variant="outlined"
              fullWidth
              margin="normal"
              value={name}
              onChange={(e) => setName(e.target.value)}
              required
            />
            <TextField
              label="Profile Image URL"
              variant="outlined"
              fullWidth
              margin="normal"
              value={profileImage}
              onChange={(e) => setProfileImage(e.target.value)}
            />
            <Button type="submit" variant="contained" color="primary" fullWidth>
              Update Profile
            </Button>
          </form>
          {message && <Typography variant="body1">{message}</Typography>}
        </Container>
      );
    };
    
    export default Profile;
    
    ```
    
2. **ルーティングの追加**
    - **`src/main.tsx`の編集**
        
        ```tsx
        // src/main.tsx
        import React from 'react';
        import ReactDOM from 'react-dom';
        import { BrowserRouter as Router, Routes, Route } from 'react-router-dom';
        import App from './App';
        import Register from './pages/Register';
        import Login from './pages/Login';
        import Profile from './pages/Profile';
        
        ReactDOM.render(
          <React.StrictMode>
            <Router>
              <Routes>
                <Route path="/" element={<App />} />
                <Route path="/register" element={<Register />} />
                <Route path="/login" element={<Login />} />
                <Route path="/profile" element={<Profile />} />
              </Routes>
            </Router>
          </React.StrictMode>,
          document.getElementById('root')
        );
        
        ```
        
3. **ナビゲーションの更新**
    - **`App.tsx`の修正**
        
        ```tsx
        // src/App.tsx
        import React from 'react';
        import { Link } from 'react-router-dom';
        import { AppBar, Toolbar, Typography, Button } from '@mui/material';
        
        const App: React.FC = () => {
          return (
            <div>
              <AppBar position="static">
                <Toolbar>
                  <Typography variant="h6" style={{ flexGrow: 1 }}>
                    izumi
                  </Typography>
                  <Button color="inherit" component={Link} to="/register">
                    Register
                  </Button>
                  <Button color="inherit" component={Link} to="/login">
                    Login
                  </Button>
                  <Button color="inherit" component={Link} to="/profile">
                    Profile
                  </Button>
                </Toolbar>
              </AppBar>
              <Typography variant="h3" align="center" style={{ marginTop: '50px' }}>
                Welcome to izumi
              </Typography>
            </div>
          );
        };
        
        export default App;
        
        ```
        
4. **Gitへのコミット**
    
    ```bash
    git add .
    git commit -m "Implement profile page with fetch and update functionality"
    git push
    
    ```
    

---

## **ステップ8: 提供者と購読者のロール管理の実装**

### **8.1. ロールに応じたアクセス制御の実装**

1. **バックエンドでのミドルウェア作成**
    - **`authMiddleware.ts`の作成**
        
        ```tsx
        // src/middleware/authMiddleware.ts
        import { Request, Response, NextFunction } from 'express';
        import jwt from 'jsonwebtoken';
        
        interface AuthenticatedRequest extends Request {
          user?: any;
        }
        
        export const authenticateToken = (req: AuthenticatedRequest, res: Response, next: NextFunction) => {
          const authHeader = req.headers['authorization'];
          const token = authHeader && authHeader.split(' ')[1];
        
          if (!token) return res.sendStatus(401);
        
          jwt.verify(token, 'your_jwt_secret', (err: any, user: any) => {
            if (err) return res.sendStatus(403);
            req.user = user;
            next();
          });
        };
        
        export const authorizeRoles = (...roles: string[]) => {
          return (req: AuthenticatedRequest, res: Response, next: NextFunction) => {
            if (!req.user || !roles.includes(req.user.role)) {
              return res.sendStatus(403);
            }
            next();
          };
        };
        
        ```
        
2. **ルートでのミドルウェア適用**
    - 例として、管理者専用のルートを作成します。
    - **`admin.ts`の作成**
        
        ```tsx
        // src/routes/admin.ts
        import { Router, Request, Response } from 'express';
        import { authenticateToken, authorizeRoles } from '../middleware/authMiddleware';
        import User from '../models/User';
        
        const router = Router();
        
        // ユーザー一覧の取得（管理者専用）
        router.get('/users', authenticateToken, authorizeRoles('admin'), async (req: Request, res: Response) => {
          try {
            const users = await User.findAll({
              attributes: ['id', 'email', 'name', 'role', 'createdAt', 'updatedAt'],
            });
            res.status(200).json(users);
          } catch (error) {
            console.error(error);
            res.status(500).json({ message: 'Server error.' });
          }
        });
        
        // ユーザーのBAN
        router.post('/ban/:id', authenticateToken, authorizeRoles('admin'), async (req: Request, res: Response) => {
          const userId = req.params.id;
          try {
            const user = await User.findByPk(userId);
            if (!user) {
              return res.status(404).json({ message: 'User not found.' });
            }
            // ここでユーザーをBANするためのロジックを実装
            // 例: user.banned = true;
            // await user.save();
            res.status(200).json({ message: 'User banned successfully.' });
          } catch (error) {
            console.error(error);
            res.status(500).json({ message: 'Server error.' });
          }
        });
        
        export default router;
        
        ```
        
3. **ルートの統合**
    - **`index.ts`の修正**
        
        ```tsx
        // src/index.ts
        import express from 'express';
        import sequelize from './config/database';
        import User from './models/User';
        import authRoutes from './routes/auth';
        import profileRoutes from './routes/profile';
        import adminRoutes from './routes/admin';
        import cors from 'cors';
        
        const app = express();
        const PORT = process.env.PORT || 5000;
        
        app.use(cors());
        app.use(express.json());
        
        app.use('/api/auth', authRoutes);
        app.use('/api/profile', profileRoutes);
        app.use('/api/admin', adminRoutes);
        
        app.get('/', (req, res) => {
          res.send('Hello izumi!');
        });
        
        sequelize.authenticate()
          .then(() => {
            console.log('Database connected...');
            return sequelize.sync();
          })
          .then(() => {
            console.log('Models synchronized.');
          })
          .catch((err) => {
            console.error('Unable to connect to the database:', err);
          });
        
        app.listen(PORT, () => {
          console.log(`Server is running on port ${PORT}`);
        });
        
        ```
        
4. **フロントエンドでの管理者ページの作成**
    - **`Admin.tsx`の作成**
        
        ```tsx
        // src/pages/Admin.tsx
        import React, { useState, useEffect } from 'react';
        import axios from 'axios';
        import { Container, Typography, Table, TableBody, TableCell, TableHead, TableRow, Button } from '@mui/material';
        
        const Admin: React.FC = () => {
          const [users, setUsers] = useState([]);
          const [message, setMessage] = useState('');
        
          useEffect(() => {
            const fetchUsers = async () => {
              const token = localStorage.getItem('token');
              try {
                const res = await axios.get('/api/admin/users', {
                  headers: {
                    Authorization: `Bearer ${token}`,
                  },
                });
                setUsers(res.data);
              } catch (error: any) {
                setMessage(error.response?.data?.message || 'Failed to fetch users.');
              }
            };
        
            fetchUsers();
          }, []);
        
          const handleBan = async (id: number) => {
            const token = localStorage.getItem('token');
            try {
              const res = await axios.post(`/api/admin/ban/${id}`, {}, {
                headers: {
                  Authorization: `Bearer ${token}`,
                },
              });
              setMessage(res.data.message);
              // 更新後のユーザーリストを再取得
              const updatedUsers = users.map((user: any) =>
                user.id === id ? { ...user, banned: true } : user
              );
              setUsers(updatedUsers);
            } catch (error: any) {
              setMessage(error.response?.data?.message || 'Failed to ban user.');
            }
          };
        
          return (
            <Container>
              <Typography variant="h4" gutterBottom>
                Admin Panel
              </Typography>
              {message && <Typography variant="body1">{message}</Typography>}
              <Table>
                <TableHead>
                  <TableRow>
                    <TableCell>ID</TableCell>
                    <TableCell>Email</TableCell>
                    <TableCell>Name</TableCell>
                    <TableCell>Role</TableCell>
                    <TableCell>Actions</TableCell>
                  </TableRow>
                </TableHead>
                <TableBody>
                  {users.map((user: any) => (
                    <TableRow key={user.id}>
                      <TableCell>{user.id}</TableCell>
                      <TableCell>{user.email}</TableCell>
                      <TableCell>{user.name}</TableCell>
                      <TableCell>{user.role}</TableCell>
                      <TableCell>
                        <Button variant="contained" color="secondary" onClick={() => handleBan(user.id)}>
                          BAN
                        </Button>
                      </TableCell>
                    </TableRow>
                  ))}
                </TableBody>
              </Table>
            </Container>
          );
        };
        
        export default Admin;
        
        ```
        
5. **ルーティングの追加**
    - **`src/main.tsx`の編集**
        
        ```tsx
        // src/main.tsx
        import React from 'react';
        import ReactDOM from 'react-dom';
        import { BrowserRouter as Router, Routes, Route } from 'react-router-dom';
        import App from './App';
        import Register from './pages/Register';
        import Login from './pages/Login';
        import Profile from './pages/Profile';
        import Admin from './pages/Admin';
        
        ReactDOM.render(
          <React.StrictMode>
            <Router>
              <Routes>
                <Route path="/" element={<App />} />
                <Route path="/register" element={<Register />} />
                <Route path="/login" element={<Login />} />
                <Route path="/profile" element={<Profile />} />
                <Route path="/admin" element={<Admin />} />
              </Routes>
            </Router>
          </React.StrictMode>,
          document.getElementById('root')
        );
        
        ```
        
6. **管理者ページへのアクセス制御**
    - **ユーザーのロールを確認して表示制限を行う**
        - **`App.tsx`の修正**
            
            ```tsx
            // src/App.tsx
            import React from 'react';
            import { Link } from 'react-router-dom';
            import { AppBar, Toolbar, Typography, Button } from '@mui/material';
            
            const App: React.FC = () => {
              const token = localStorage.getItem('token');
              const [role, setRole] = React.useState<string | null>(null);
            
              React.useEffect(() => {
                if (token) {
                  const decoded: any = JSON.parse(atob(token.split('.')[1]));
                  setRole(decoded.role);
                }
              }, [token]);
            
              return (
                <div>
                  <AppBar position="static">
                    <Toolbar>
                      <Typography variant="h6" style={{ flexGrow: 1 }}>
                        izumi
                      </Typography>
                      {!token && (
                        <>
                          <Button color="inherit" component={Link} to="/register">
                            Register
                          </Button>
                          <Button color="inherit" component={Link} to="/login">
                            Login
                          </Button>
                        </>
                      )}
                      {token && (
                        <>
                          <Button color="inherit" component={Link} to="/profile">
                            Profile
                          </Button>
                          {role === 'admin' && (
                            <Button color="inherit" component={Link} to="/admin">
                              Admin
                            </Button>
                          )}
                        </>
                      )}
                    </Toolbar>
                  </AppBar>
                  <Typography variant="h3" align="center" style={{ marginTop: '50px' }}>
                    Welcome to izumi
                  </Typography>
                </div>
              );
            };
            
            export default App;
            
            ```
            
7. **Gitへのコミット**
    
    ```bash
    git add .
    git commit -m "Implement admin panel with user management and role-based access control"
    git push
    
    ```
    

---

## **ステップ9: 商材管理機能の実装**

### **9.1. 商材モデルの作成**

1. **`Product.ts`の作成**
    
    ```tsx
    // src/models/Product.ts
    import { DataTypes, Model } from 'sequelize';
    import sequelize from '../config/database';
    import User from './User';
    
    class Product extends Model {
      public id!: number;
      public title!: string;
      public description!: string;
      public category!: string;
      public fileUrl!: string;
      public fileType!: string; // PDF, MP4, MP3
      public fileSize!: number; // in bytes
      public providerId!: number;
      public readonly createdAt!: Date;
      public readonly updatedAt!: Date;
    }
    
    Product.init(
      {
        id: {
          type: DataTypes.INTEGER,
          autoIncrement: true,
          primaryKey: true,
        },
        title: {
          type: DataTypes.STRING,
          allowNull: false,
        },
        description: {
          type: DataTypes.TEXT,
          allowNull: false,
        },
        category: {
          type: DataTypes.STRING,
          allowNull: false,
        },
        fileUrl: {
          type: DataTypes.STRING,
          allowNull: false,
        },
        fileType: {
          type: DataTypes.STRING,
          allowNull: false,
        },
        fileSize: {
          type: DataTypes.INTEGER,
          allowNull: false,
        },
        providerId: {
          type: DataTypes.INTEGER,
          allowNull: false,
          references: {
            model: User,
            key: 'id',
          },
        },
      },
      {
        sequelize,
        tableName: 'products',
      }
    );
    
    export default Product;
    
    ```
    
2. **モデルの関連付け**
    - **`User.ts`の編集**
        
        ```tsx
        // src/models/User.ts
        import { DataTypes, Model, HasManyGetAssociationsMixin } from 'sequelize';
        import sequelize from '../config/database';
        import Product from './Product';
        
        class User extends Model {
          public id!: number;
          public email!: string;
          public password!: string;
          public name!: string;
          public profileImage!: string;
          public role!: string; // 'subscriber', 'provider', 'admin'
          public readonly createdAt!: Date;
          public readonly updatedAt!: Date;
        
          // Association methods
          public getProducts!: HasManyGetAssociationsMixin<Product>;
        }
        
        User.init(
          {
            id: {
              type: DataTypes.INTEGER,
              autoIncrement: true,
              primaryKey: true,
            },
            email: {
              type: DataTypes.STRING,
              allowNull: false,
              unique: true,
            },
            password: {
              type: DataTypes.STRING,
              allowNull: false,
            },
            name: {
              type: DataTypes.STRING,
              allowNull: false,
            },
            profileImage: {
              type: DataTypes.STRING,
              allowNull: true,
            },
            role: {
              type: DataTypes.STRING,
              allowNull: false,
              defaultValue: 'subscriber',
            },
          },
          {
            sequelize,
            tableName: 'users',
          }
        );
        
        User.hasMany(Product, { foreignKey: 'providerId', as: 'products' });
        Product.belongsTo(User, { foreignKey: 'providerId', as: 'provider' });
        
        export default User;
        
        ```
        
3. **データベースの同期**
    - **サーバーの再起動**
        
        ```bash
        npm run dev
        
        ```
        
    - コンソールに「Models synchronized.」と表示され、新しいテーブルが作成されます。
4. **Gitへのコミット**
    
    ```bash
    git add .
    git commit -m "Create Product model and associate with User"
    git push
    
    ```
    

### **9.2. 商材アップロードAPIの実装**

1. **ファイルアップロード用のパッケージのインストール**
    
    ```bash
    npm install multer
    npm install --save-dev @types/multer
    
    ```
    
    - **multer:** ファイルアップロードを処理するミドルウェア。
2. **AWS SDKのインストール**
    
    ```bash
    npm install aws-sdk
    npm install --save-dev @types/aws-sdk
    
    ```
    
    - **aws-sdk:** AWS S3にファイルをアップロードするためのライブラリ。
3. **AWS S3の設定**
    - **AWSアカウントの作成（まだの場合）**
        - [AWS公式サイト](https://aws.amazon.com/)からアカウントを作成します。
    - **S3バケットの作成**
        - AWS管理コンソールからS3サービスにアクセスし、新しいバケットを作成します。
        - バケット名やリージョンを設定し、公開アクセスを制限します。
    - **アクセスキーの取得**
        - IAMサービスから新しいユーザーを作成し、S3へのアクセス権限を付与します。
        - アクセスキーIDとシークレットアクセスキーを安全な場所に保存します。
4. **ファイルアップロードルートの作成**
    - **`product.ts`の作成**
        
        ```tsx
        // src/routes/product.ts
        import { Router, Request, Response } from 'express';
        import multer from 'multer';
        import AWS from 'aws-sdk';
        import { authenticateToken, authorizeRoles } from '../middleware/authMiddleware';
        import Product from '../models/Product';
        
        const router = Router();
        
        // AWS S3設定
        const s3 = new AWS.S3({
          accessKeyId: 'YOUR_AWS_ACCESS_KEY_ID',
          secretAccessKey: 'YOUR_AWS_SECRET_ACCESS_KEY',
          region: 'YOUR_S3_BUCKET_REGION',
        });
        
        // multer設定
        const storage = multer.memoryStorage();
        const upload = multer({
          storage,
          limits: { fileSize: 100 * 1024 * 1024 }, // 100MB
          fileFilter: (req, file, cb) => {
            const allowedTypes = ['application/pdf', 'video/mp4', 'audio/mpeg'];
            if (allowedTypes.includes(file.mimetype)) {
              cb(null, true);
            } else {
              cb(new Error('Invalid file type.'));
            }
          },
        });
        
        // 商材アップロード
        router.post(
          '/upload',
          authenticateToken,
          authorizeRoles('provider'),
          upload.single('file'),
          async (req: Request, res: Response) => {
            const { title, description, category } = req.body;
            const file = req.file;
        
            if (!file) {
              return res.status(400).json({ message: 'No file uploaded.' });
            }
        
            // S3にファイルをアップロード
            const params = {
              Bucket: 'YOUR_S3_BUCKET_NAME',
              Key: `${Date.now()}_${file.originalname}`,
              Body: file.buffer,
              ContentType: file.mimetype,
            };
        
            try {
              const data = await s3.upload(params).promise();
              // 商材情報のデータベース保存
              const product = await Product.create({
                title,
                description,
                category,
                fileUrl: data.Location,
                fileType: file.mimetype.split('/')[1], // 'pdf', 'mp4', 'mp3'
                fileSize: file.size,
                providerId: req.user.id,
              });
        
              res.status(201).json({ message: 'Product uploaded successfully.', product });
            } catch (error) {
              console.error(error);
              res.status(500).json({ message: 'File upload failed.' });
            }
          }
        );
        
        export default router;
        
        ```
        
5. **ルートの統合**
    - **`index.ts`の修正**
        
        ```tsx
        // src/index.ts
        import express from 'express';
        import sequelize from './config/database';
        import User from './models/User';
        import Product from './models/Product';
        import authRoutes from './routes/auth';
        import profileRoutes from './routes/profile';
        import adminRoutes from './routes/admin';
        import productRoutes from './routes/product';
        import cors from 'cors';
        
        const app = express();
        const PORT = process.env.PORT || 5000;
        
        app.use(cors());
        app.use(express.json());
        
        app.use('/api/auth', authRoutes);
        app.use('/api/profile', profileRoutes);
        app.use('/api/admin', adminRoutes);
        app.use('/api/product', productRoutes);
        
        app.get('/', (req, res) => {
          res.send('Hello izumi!');
        });
        
        sequelize.authenticate()
          .then(() => {
            console.log('Database connected...');
            return sequelize.sync();
          })
          .then(() => {
            console.log('Models synchronized.');
          })
          .catch((err) => {
            console.error('Unable to connect to the database:', err);
          });
        
        app.listen(PORT, () => {
          console.log(`Server is running on port ${PORT}`);
        });
        
        ```
        
6. **フロントエンドでの商材アップロードページの作成**
    - **`UploadProduct.tsx`の作成**
        
        ```tsx
        // src/pages/UploadProduct.tsx
        import React, { useState } from 'react';
        import axios from 'axios';
        import { TextField, Button, Container, Typography, Select, MenuItem, InputLabel, FormControl } from '@mui/material';
        
        const UploadProduct: React.FC = () => {
          const [title, setTitle] = useState('');
          const [description, setDescription] = useState('');
          const [category, setCategory] = useState('');
          const [file, setFile] = useState<File | null>(null);
          const [message, setMessage] = useState('');
        
          const handleUpload = async (e: React.FormEvent) => {
            e.preventDefault();
            if (!file) {
              setMessage('Please select a file to upload.');
              return;
            }
        
            const token = localStorage.getItem('token');
            const formData = new FormData();
            formData.append('title', title);
            formData.append('description', description);
            formData.append('category', category);
            formData.append('file', file);
        
            try {
              const res = await axios.post('/api/product/upload', formData, {
                headers: {
                  'Content-Type': 'multipart/form-data',
                  Authorization: `Bearer ${token}`,
                },
              });
              setMessage(res.data.message);
            } catch (error: any) {
              setMessage(error.response?.data?.message || 'Upload failed.');
            }
          };
        
          return (
            <Container maxWidth="sm">
              <Typography variant="h4" gutterBottom>
                Upload Product
              </Typography>
              <form onSubmit={handleUpload}>
                <TextField
                  label="Title"
                  variant="outlined"
                  fullWidth
                  margin="normal"
                  value={title}
                  onChange={(e) => setTitle(e.target.value)}
                  required
                />
                <TextField
                  label="Description"
                  variant="outlined"
                  fullWidth
                  margin="normal"
                  multiline
                  rows={4}
                  value={description}
                  onChange={(e) => setDescription(e.target.value)}
                  required
                />
                <FormControl fullWidth margin="normal">
                  <InputLabel>Category</InputLabel>
                  <Select value={category} onChange={(e) => setCategory(e.target.value as string)} required>
                    <MenuItem value="Education">Education</MenuItem>
                    <MenuItem value="Business">Business</MenuItem>
                    <MenuItem value="Lifestyle">Lifestyle</MenuItem>
                    {/* 必要に応じてカテゴリーを追加 */}
                  </Select>
                </FormControl>
                <Button variant="contained" component="label" fullWidth style={{ marginTop: '20px' }}>
                  Select File
                  <input
                    type="file"
                    hidden
                    onChange={(e) => {
                      if (e.target.files && e.target.files[0]) {
                        setFile(e.target.files[0]);
                      }
                    }}
                  />
                </Button>
                {file && <Typography variant="body1" style={{ marginTop: '10px' }}>{file.name}</Typography>}
                <Button type="submit" variant="contained" color="primary" fullWidth style={{ marginTop: '20px' }}>
                  Upload
                </Button>
              </form>
              {message && <Typography variant="body1">{message}</Typography>}
            </Container>
          );
        };
        
        export default UploadProduct;
        
        ```
        
7. **ルーティングの追加**
    - **`src/main.tsx`の編集**
        
        ```tsx
        // src/main.tsx
        import React from 'react';
        import ReactDOM from 'react-dom';
        import { BrowserRouter as Router, Routes, Route } from 'react-router-dom';
        import App from './App';
        import Register from './pages/Register';
        import Login from './pages/Login';
        import Profile from './pages/Profile';
        import Admin from './pages/Admin';
        import UploadProduct from './pages/UploadProduct';
        
        ReactDOM.render(
          <React.StrictMode>
            <Router>
              <Routes>
                <Route path="/" element={<App />} />
                <Route path="/register" element={<Register />} />
                <Route path="/login" element={<Login />} />
                <Route path="/profile" element={<Profile />} />
                <Route path="/admin" element={<Admin />} />
                <Route path="/upload" element={<UploadProduct />} />
              </Routes>
            </Router>
          </React.StrictMode>,
          document.getElementById('root')
        );
        
        ```
        
8. **ナビゲーションの更新**
    - **`App.tsx`の修正**
        
        ```tsx
        // src/App.tsx
        import React from 'react';
        import { Link } from 'react-router-dom';
        import { AppBar, Toolbar, Typography, Button } from '@mui/material';
        
        const App: React.FC = () => {
          const token = localStorage.getItem('token');
          const [role, setRole] = React.useState<string | null>(null);
        
          React.useEffect(() => {
            if (token) {
              const decoded: any = JSON.parse(atob(token.split('.')[1]));
              setRole(decoded.role);
            }
          }, [token]);
        
          return (
            <div>
              <AppBar position="static">
                <Toolbar>
                  <Typography variant="h6" style={{ flexGrow: 1 }}>
                    izumi
                  </Typography>
                  {!token && (
                    <>
                      <Button color="inherit" component={Link} to="/register">
                        Register
                      </Button>
                      <Button color="inherit" component={Link} to="/login">
                        Login
                      </Button>
                    </>
                  )}
                  {token && (
                    <>
                      <Button color="inherit" component={Link} to="/profile">
                        Profile
                      </Button>
                      {role === 'admin' && (
                        <Button color="inherit" component={Link} to="/admin">
                          Admin
                        </Button>
                      )}
                      {role === 'provider' && (
                        <Button color="inherit" component={Link} to="/upload">
                          Upload Product
                        </Button>
                      )}
                    </>
                  )}
                </Toolbar>
              </AppBar>
              <Typography variant="h3" align="center" style={{ marginTop: '50px' }}>
                Welcome to izumi
              </Typography>
            </div>
          );
        };
        
        export default App;
        
        ```
        
9. **Gitへのコミット**
    
    ```bash
    git add .
    git commit -m "Implement product upload functionality with AWS S3 integration"
    git push
    
    ```
    

---

## **ステップ10: 継続的な機能実装とテスト**

### **10.1. その他の機能の実装**

- **評価機能、ダウンロード機能、マイリスト機能などの実装**
    - 各機能ごとにモデルの作成、APIの実装、フロントエンドのページ・コンポーネントの作成を行います。
    - 各機能の詳細は要件定義書に基づき、上記のステップに沿って進めてください。

### **10.2. テストの実装**

1. **バックエンドテストの設定**
    - **必要なパッケージのインストール**
        
        ```bash
        npm install --save-dev mocha chai supertest
        
        ```
        
    - **テストスクリプトの追加**
        - **`package.json`の編集**
            
            ```json
            "scripts": {
              ...
              "test": "mocha -r ts-node/register tests/**/*.test.ts"
            },
            
            ```
            
2. **フロントエンドテストの設定**
    - **必要なパッケージのインストール**
        
        ```bash
        npm install --save-dev jest @testing-library/react @testing-library/jest-dom
        
        ```
        
    - **Jestの設定**
        - **`jest.config.js`の作成**
            
            ```jsx
            module.exports = {
              testEnvironment: 'jsdom',
              setupFilesAfterEnv: ['<rootDir>/src/setupTests.ts'],
              transform: {
                '^.+\\.tsx?$': 'ts-jest',
              },
              moduleNameMapper: {
                '^@/(.*)$': '<rootDir>/src/$1',
              },
            };
            
            ```
            
        - **`setupTests.ts`の作成**
            
            ```tsx
            import '@testing-library/jest-dom';
            
            ```
            
3. **テストの作成と実行**
    - 各機能に対してユニットテストや統合テストを作成し、`npm run test`で実行します。

### **10.3. Gitへのコミットとプッシュ**

```bash
git add .
git commit -m "Implement testing framework and add initial tests"
git push

```

---

## **ステップ11: 継続的インテグレーションとデプロイの設定**

### **11.1. GitHub Actionsの設定**

1. **GitHubリポジトリでの設定**
    - GitHubリポジトリにアクセスし、「Actions」タブをクリックします。
    - 「Set up a workflow yourself」を選択し、以下の内容で`.github/workflows/ci.yml`を作成します。
2. **CIワークフローの作成**
    
    ```yaml
    name: CI
    
    on:
      push:
        branches: [ master ]
      pull_request:
        branches: [ master ]
    
    jobs:
      build:
    
        runs-on: ubuntu-latest
    
        strategy:
          matrix:
            node-version: [14.x, 16.x]
    
        steps:
        - uses: actions/checkout@v2
        - name: Use Node.js ${{ matrix.node-version }}
          uses: actions/setup-node@v2
          with:
            node-version: ${{ matrix.node-version }}
        - run: cd server && npm install
        - run: cd server && npm run build
        - run: cd server && npm test
        - run: cd client && npm install
        - run: cd client && npm run build
        - run: cd client && npm test
    
    ```
    
3. **GitHub Actionsの実行確認**
    - コードをプッシュすると、Actionsタブでワークフローが実行されるのを確認します。

### **11.2. デプロイの設定（AWS ECSを例に）**

1. **Dockerのインストール**
    - [Docker公式サイト](https://www.docker.com/products/docker-desktop)からDocker Desktopをダウンロードし、インストールします。
2. **Dockerfileの作成**
    - **サーバー用の`Dockerfile`の作成**
        
        ```
        # server/Dockerfile
        FROM node:14
        
        WORKDIR /app
        
        COPY package*.json ./
        RUN npm install
        
        COPY . .
        
        RUN npm run build
        
        EXPOSE 5000
        
        CMD ["node", "dist/index.js"]
        
        ```
        
    - **クライアント用の`Dockerfile`の作成**
        
        ```
        # client/Dockerfile
        FROM node:14
        
        WORKDIR /app
        
        COPY package*.json ./
        RUN npm install
        
        COPY . .
        
        RUN npm run build
        
        # Serve the app using a static server
        RUN npm install -g serve
        CMD ["serve", "-s", "dist"]
        
        ```
        
3. **Dockerイメージのビルドとテスト**
    - **サーバーイメージのビルド**
        
        ```bash
        cd server
        docker build -t izumi-server .
        
        ```
        
    - **クライアントイメージのビルド**
        
        ```bash
        cd ../client
        docker build -t izumi-client .
        
        ```
        
    - **ローカルでのコンテナ起動と確認**
        
        ```bash
        docker run -p 5000:5000 izumi-server
        docker run -p 3000:5000 izumi-client
        
        ```
        
        - サーバーが`http://localhost:5000`で、クライアントが`http://localhost:3000`で動作することを確認します。
4. **AWS ECSへのデプロイ**
    - **AWS管理コンソールでECSクラスターの作成**
        - [AWS ECS公式ガイド](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/create-cluster.html)に従ってクラスターを作成します。
    - **タスク定義の作成**
        - サーバーとクライアントのコンテナを定義します。
    - **サービスの作成とデプロイ**
        - 作成したタスク定義を基にサービスを作成し、クラスターにデプロイします。

### **11.3. GitHub Actionsでの自動デプロイ設定（オプション）**

- **CI/CDワークフローにデプロイステップを追加**
    - AWS CLIや他のデプロイツールを使用して、自動的にECSにデプロイするステップを追加します。
    - 詳細は[GitHub Actionsの公式ドキュメント](https://docs.github.com/en/actions)を参照してください。

### **11.4. Gitへのコミット**

```bash
git add .
git commit -m "Set up Docker and GitHub Actions for CI/CD pipeline"
git push

```

---

## **ステップ12: 継続的な開発とフィードバックの収集**

### **12.1. 定期的なコードレビューとテスト**

- **コードの品質を保つために、定期的にコードレビューを行いましょう。**
- **テストカバレッジを増やし、バグの早期発見に努めましょう。**

### **12.2. ユーザーフィードバックの収集**

1. **ベータ版のリリース**
    - 限定的なユーザーにアプリを提供し、フィードバックを収集します。
2. **フィードバックフォームの作成**
    - フロントエンドにフィードバックフォームを追加し、ユーザーからの意見を収集します。

### **12.3. データ分析と改善**

- **ユーザーデータを分析し、利用傾向や問題点を特定します。**
- **分析結果に基づき、機能の改善や新機能の追加を検討します。**

### **12.4. ドキュメントの整備**

- **技術ドキュメントやAPIドキュメントを作成し、開発者間で共有します。**
- **ユーザー向けのガイドやチュートリアルも提供します。**

### **12.5. Gitへのコミット**

```bash
git add .
git commit -m "Set up continuous development practices and user feedback mechanisms"
git push

```

---

## **まとめ**

